{% extends './plantilla.html' %}
{% load static %}
{% block body %}

<div class="container mt-5">
    <h2 class="text-center mb-4">Registrar Nueva Persona</h2>

    <form id="formPersona" action="{% url 'guardarPersona' %}" method="POST" enctype="multipart/form-data">
        {% csrf_token %}

        <div class="mb-3">
            <label for="nombre" class="form-label">Nombre:</label>
            <input type="text" id="nombre" name="nombre" class="form-control" placeholder="Ingrese el nombre" required>
        </div>

        <div class="mb-3">
            <label for="apellido" class="form-label">Apellido:</label>
            <input type="text" id="apellido" name="apellido" class="form-control" placeholder="Ingrese el apellido" required>
        </div>

        <div class="mb-3">
            <label for="telefono" class="form-label">Teléfono:</label>
            <input type="text" id="telefono" name="telefono" class="form-control" placeholder="Ej: 0987654321">
        </div>

        <div class="mb-3">
            <label for="email" class="form-label">Correo electrónico:</label>
            <input type="email" id="email" name="email" class="form-control" placeholder="ejemplo@gmail.com">
        </div>

        <div class="mb-3">
            <label for="direccion" class="form-label">Dirección:</label>
            <textarea id="direccion" name="direccion" class="form-control" rows="3" placeholder="Ingrese la dirección"></textarea>
        </div>

        <div class="mb-3">
            <label for="imagen" class="form-label">Foto:</label>
            <!-- Input de File Input -->
            <input id="imagen" name="imagen" type="file" class="file" data-show-preview="true" data-show-remove="true" data-show-upload="false" required>
        </div>

        <div class="d-flex justify-content-between">
            <a href="{% url 'persona' %}" class="btn btn-secondary">Cancelar</a>
            <button type="button" class="btn btn-success" onclick="confirmarGuardado();">Guardar Persona</button>
        </div>
    </form>
</div>

<script>
function confirmarGuardado() {
    Swal.fire({
        title: '¿Desea guardar esta persona?',
        icon: 'question',
        showCancelButton: true,
        confirmButtonText: 'Sí, guardar',
        cancelButtonText: 'Cancelar',
        confirmButtonColor: '#28a745',
        cancelButtonColor: '#d33'
    }).then((result) => {
        if (result.isConfirmed) {
            document.getElementById('formPersona').submit();
        }
    });
}
</script>


<script>
$(document).ready(function() {
    $("#imagen").fileinput({
        language: 'es',
        allowedFileExtensions: ['jpg', 'jpeg', 'png'],
        maxFileSize: 2048, // 2 MB
        showPreview: true,
        showUpload: false,
        showRemove: true,
        initialPreviewAsData: true,
        theme: 'fas'
    });
});
</script>

<script>
$(document).ready(function() {
    // Método para permitir solo letras
    $.validator.addMethod("lettersonly", function(value, element) {
        return this.optional(element) || /^[a-zA-ZáéíóúÁÉÍÓÚñÑ\s]+$/.test(value);
    }, "Solo se permiten letras");

    // Validación del formulario
    $("#formPersona").validate({
        rules: {
            nombre: {
                required: true,
                minlength: 2,
                maxlength: 50,
                lettersonly: true
            },
            apellido: {
                required: true,
                minlength: 2,
                maxlength: 50,
                lettersonly: true
            },
            telefono: {
                required: true,
                digits: true,
                minlength: 9,
                maxlength: 15
            },
            email: {
                required: true,
                email: true
            },
            direccion: {
                required: true,
                minlength: 5,
                maxlength: 200
            },
            imagen: {
                required: true,
                extension: "jpg|jpeg|png"
            }
        },
        messages: {
            nombre: {
                required: "El nombre no puede estar vacío",
                minlength: "El nombre debe tener al menos 2 caracteres",
                maxlength: "El nombre no debe exceder 50 caracteres",
                lettersonly: "Solo se permiten letras"
            },
            apellido: {
                required: "El apellido no puede estar vacío",
                minlength: "El apellido debe tener al menos 2 caracteres",
                maxlength: "El apellido no debe exceder 50 caracteres",
                lettersonly: "Solo se permiten letras"
            },
            telefono: {
                required: "El teléfono no puede estar vacío",
                digits: "Solo se permiten números",
                minlength: "El teléfono debe tener al menos 9 dígitos",
                maxlength: "El teléfono no debe exceder 15 dígitos"
            },
            email: {
                required: "El correo electrónico no puede estar vacío",
                email: "Ingrese un correo válido"
            },
            direccion: {
                required: "La dirección no puede estar vacía",
                minlength: "La dirección debe tener al menos 5 caracteres",
                maxlength: "La dirección no debe exceder 200 caracteres"
            },
            imagen: {
                required: "Debe seleccionar una imagen",
                extension: "Solo se permiten archivos JPG, JPEG o PNG"
            }
        },
        errorElement: "span",
        errorClass: "error text-danger",
        highlight: function(element) {
            $(element).addClass("is-invalid");
        },
        unhighlight: function(element) {
            $(element).removeClass("is-invalid");
        },
        submitHandler: function(form) {
            form.submit(); 
        }
    });
});
</script>



{% endblock %}
